{"componentChunkName":"component---src-templates-blog-post-js","path":"/raspberrypi-google-drive/","result":{"data":{"site":{"siteMetadata":{"title":"NARAZUKE","author":[{"name":"nozzle","summary":"who lives in gummaken.","social":{"github":"nozzlex3"}},{"name":"konnyaku","summary":"who is known as Siege Sukosuko Samurai.","social":{"github":"wabetarou"}}]}},"markdownRemark":{"id":"5e0638c2-8379-5d25-a96d-a8ea7ac060e3","excerpt":"結論 Rclone を systemd で自動起動してマウントするのが良い。 だから、google-drive-ocamlfuse とか rc.local の記事は見なくていいよ。 まとめ google-drive-ocamlfuse マウントする GoogleDrive…","html":"<h2>結論</h2>\n<p>Rclone を systemd で自動起動してマウントするのが良い。<br>\nだから、google-drive-ocamlfuse とか rc.local の記事は見なくていいよ。</p>\n<h2>まとめ</h2>\n<h3>google-drive-ocamlfuse</h3>\n<ul>\n<li>マウントする</li>\n<li>GoogleDrive 内のファイルを直接操作できる</li>\n<li>ストレージ要らず</li>\n<li>インターネットによるネットワーク接続で操作が重い</li>\n<li>ラズパイが熱を持つ</li>\n</ul>\n<h3>Rclone</h3>\n<ul>\n<li>同期する</li>\n<li><strong>マウントもできる</strong></li>\n<li>片方向の同期しかできない</li>\n<li>ストレージを圧迫する</li>\n<li>操作が軽い</li>\n</ul>\n<h2>google-drive-ocamlfuse</h2>\n<h3>公式</h3>\n<p><a href=\"https://github.com/astrada/google-drive-ocamlfuse/wiki/Installation\">Installation | google-drive-ocamlfuse</a></p>\n<h3>インストール</h3>\n<pre><code class=\"language-bash:title=bash\">sudo add-apt-repository ppa:alessandro-strada/ppa\nsudo apt update\nsudo apt install google-drive-ocamlfuse\n</code></pre>\n<p>でも ppa の参照先増やしたくないねって人は</p>\n<pre><code class=\"language-bash:title=bash\">sudo apt upgrade\nsudo apt install opam mccs\nopam init --solver=mccs\nopam update\nopam install depext\nopam depext google-drive-ocamlfuse\nopam install google-drive-ocamlfuse\n</code></pre>\n<p>ってやれば<code>opam</code>経由でインストールできる。</p>\n<p>参考：<a href=\"https://qiita.com/teamhimeH/items/9910d648da0a9ff09946\">SSH 接続の Raspberry Pi に Google Drive をマウントする | Qiita</a></p>\n<h3>認証</h3>\n<pre><code class=\"language-bash:title=bash\">google-drive-ocamlfuse\n</code></pre>\n<p>って出たらブラウザが立ち上がって認証トークンがでてできる。</p>\n<p>SSH 接続でやりたい人は上の参考記事を参照するとできる。<br>\n偽のブラウザ作ってブラウザの表示をターミナルに出すっていう発想がすごいよね。</p>\n<h3>マウントする</h3>\n<pre><code class=\"language-bash:title=title\">google-drive-ocamlfuse [マウントしたいフォルダ]\n~/.opam/default/bin/google-drive-ocamlfuse [マウントしたいフォルダ]     # opam経由でインストールした人\n</code></pre>\n<p>これやったらラズパイが 52℃ くらいになってびっくりしました。</p>\n<h2>Rclone</h2>\n<h3>公式</h3>\n<p><a href=\"https://rclone.org/downloads/\">Rclone Downloads v1.54.1 | Rclone</a></p>\n<h3>インストール</h3>\n<pre><code class=\"language-bash:title=bash\">curl https://rclone.org/install.sh | sudo bash\n</code></pre>\n<h3>認証</h3>\n<p>Google Drive についての Rclone 公式の説明<br>\n<a href=\"https://rclone.org/drive/\">Google Drive | Rclone</a></p>\n<pre><code>rclone config\n</code></pre>\n<p>基本指示にしたがえばできる。<br>\nclient<em>id, client</em>secret, root<em>folder</em>id, service<em>account</em>file は空欄でいい。<br>\nAuto config の設定もしなくていいし、team drive の設定もしなくていい。</p>\n<p>URL にアクセスして、出てきた認証コードをターミナルに打ち込むとできる。</p>\n<h3>使い方</h3>\n<p><strong>ミスるとデータが消えるから注意が必要</strong></p>\n<h4>基本</h4>\n<pre><code class=\"language-bash:title=bash\">rclone sync [同期元] [同期先] --dry-run     # 同期は行わずに、実行時に起きるファイル操作を確認する\nrclone sync [同期元] [同期先]               # 同期を行う\n</code></pre>\n<p>もし、rclone に<code>gdrive-remote</code>と登録してて、ラズパイ上の<code>./gdrive-local</code>っていうフォルダに同期させたいなら、<code>rclone sync gdrive-remote: ./gdrive-local</code>でできる。</p>\n<h4>オプション</h4>\n<pre><code class=\"language-bash:title=bash\">rclone sync [同期元] [同期先]\n</code></pre>\n<h4>マウント(実験的機能)</h4>\n<pre><code class=\"language-bash:title=bash\">rclone mount [同期元] [同期先]                          # これでいい\nrclone --vfs-cache-mode writes mount [同期元] [同期先]  # こっちはエラーが減るらしいけど試してない\n</code></pre>\n<p>マウントもできた。</p>\n<h2>自動マウント設定</h2>\n<h3>結論</h3>\n<p>rc.local ではなく、systemd を使おう。</p>\n<h3>rc.local</h3>\n<p><code>~/etc/rc.local</code>というファイルにコマンドを書き込むと、起動時に実行してくれる。</p>\n<pre><code class=\"language-bash:title=/etc/rc.local\">[任意のコマンド]\n</code></pre>\n<p>しかし、コマンドの実行者が管理者になってしまうところは留意しなくてはならない。</p>\n<p>rclone の場合、mount を実行した人が管理者なら、マウントしたディレクトリも全部管理者のものになってしまい、ファイルを参照できなくなってしまう。</p>\n<p>おまけに一部の OS では非推奨らしい。</p>\n<blockquote>\n<p>RedHat、CentOS 7 系より rc.local を利用しないことが推奨されている</p>\n</blockquote>\n<p>引用元：<a href=\"https://go-journey.club/archives/11506\">【Linux】【rc.local】Linux OS 起動時に自動的に実行する設定を入れる | 100%レンタルサーバーを使いこなすサイト</a></p>\n<h3>systemd</h3>\n<p>hogehoge.service というファイルを作って systemd に管理してもらう。</p>\n<h4>マウントするスクリプトを作る</h4>\n<pre><code class=\"language-bash:title=/home/[user]/shellscript/hoge.sh\">#!/bin/bash\nrclone mount [同期元のフォルダ] [同期先のフォルダ]\n</code></pre>\n<h4>rclone のコンフィグファイルの権限を変更する</h4>\n<pre><code class=\"language-bash:title=bash\">sudo chmod 755 ~/.config/rclone/rclone.config\n</code></pre>\n<h4>service ファイルを作る。</h4>\n<p>ディレクトリを間違えて<code>etc/systemd/hogehoge.service</code>としないように注意。(1 敗)</p>\n<pre><code class=\"language-bash:title=/etc/systemd/system/hogehoge.service\">[Unit]\nDescription=To mount Google Drive\nAfter=network.target                # ネットワーク接続後に実行する\n\n[Service]\nExecStart=/home/[user]/shellscript/hoge.sh\nType=simple\nUser=[ユーザ名]\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<p>[Service]のユーザオプションのおかげでちゃんと一般ユーザ権限のディレクトリとしてマウントできる。</p>\n<h4>自動起動の設定</h4>\n<pre><code class=\"language-bash:title=bash\">sudo systemctl daemon-reload            # serviceファイルを読み込む\nsudo systemctl status hogehoge.service  # hogehoge.serviceが読み込まれたか確認する\nsudo systemctl enable hogehoge.service  # hogehoge.serviceを起動時に実行するようにする\nsudo systemctl disable hogehoge.service # 起動しないようにする(メモ)\n</code></pre>\n<h4>マウントしたディレクトリを確認</h4>\n<p><code>df -h</code>すればいい<br>\n参考：<a href=\"https://narazuke.github.io/linux-command-filesystem/\">Linux のファイルシステムコマンドまとめ | NARAZUKE </a></p>\n<p><img src=\"./raspberrypi-google-drive_01.png\"></p>\n<p>できました。</p>","fields":{"slug":"/raspberrypi-google-drive/"},"frontmatter":{"title":"ラズパイでGoogle Driveを使う","created":"2021-03-11T21:17","updated":"2021-03-12T18:18","description":"Rclone を systemd で自動起動してマウントするのが良い。","tag":["raspberrypi"],"author":["nozzle"],"category":"tech"}},"previous":{"fields":{"slug":"/mac-setting-memo/"},"frontmatter":{"title":"M1 Mac環境構築メモ"}},"next":{"fields":{"slug":"/mac-backslash/"},"frontmatter":{"title":"Macでバックスラッシュを入力する"}},"relatedPosts":{"totalCount":7,"edges":[{"node":{"fields":{"slug":"/trouble-shooting-moduleerror-ndef/"},"frontmatter":{"title":"nfcpyの実験中\"ModuleNotFoundError No module named 'ndef'が出た"}}},{"node":{"fields":{"slug":"/raspberrypi-setting-memo/"},"frontmatter":{"title":"ラズパイ環境設定メモ"}}},{"node":{"fields":{"slug":"/wordpress-setting/"},"frontmatter":{"title":"WordPress設定備忘録"}}},{"node":{"fields":{"slug":"/raspberrypi-static-ipaddress/"},"frontmatter":{"title":"ラズパイのIPアドレスを固定する方法"}}},{"node":{"fields":{"slug":"/raspberrypi-ssd-boot/"},"frontmatter":{"title":"SDカードなしでRaspberry Pi 4B を SSDでUSB bootする"}}},{"node":{"fields":{"slug":"/raspberrypi-google-drive/"},"frontmatter":{"title":"ラズパイでGoogle Driveを使う"}}},{"node":{"fields":{"slug":"/pyenv-venv-virtual-environment/"},"frontmatter":{"title":"pyenvとvenvで仮想環境構築 ラズパイ編"}}}]}},"pageContext":{"id":"5e0638c2-8379-5d25-a96d-a8ea7ac060e3","previousPostId":"3f27bea9-4a05-5b25-8c7f-1162d271115b","nextPostId":"c4e02773-30bd-5210-8263-93521f4f8b1e","category":"tech","tagList":["raspberrypi"]}},"staticQueryHashes":["3284037645","500847697"]}