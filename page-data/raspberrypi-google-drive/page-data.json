{"componentChunkName":"component---src-templates-blog-post-js","path":"/raspberrypi-google-drive/","result":{"data":{"site":{"siteMetadata":{"title":"NARAZUKE","author":[{"name":"nozzle","summary":"who lives in gummaken.","social":{"github":"nozzlex3"}},{"name":"konnyaku","summary":"who is known as Siege Sukosuko Samurai.","social":{"github":"wabetarou"}}]}},"markdownRemark":{"id":"62ba7fc9-05e7-558b-91ab-f80fd4604e68","excerpt":"結論 Rclone を systemd で自動起動してマウントするのが良い。 だから、google-drive-ocamlfuse とか rc.local の記事は見なくていいよ。 まとめ google-drive-ocamlfuse マウントする GoogleDrive…","html":"<h2>結論</h2>\n<p>Rclone を systemd で自動起動してマウントするのが良い。<br>\nだから、google-drive-ocamlfuse とか rc.local の記事は見なくていいよ。</p>\n<h2>まとめ</h2>\n<h3>google-drive-ocamlfuse</h3>\n<ul>\n<li>マウントする</li>\n<li>GoogleDrive 内のファイルを直接操作できる</li>\n<li>ストレージ要らず</li>\n<li>インターネットによるネットワーク接続で操作が重い</li>\n<li>ラズパイが熱を持つ</li>\n</ul>\n<h3>Rclone</h3>\n<ul>\n<li>同期する</li>\n<li><strong>マウントもできる</strong></li>\n<li>片方向の同期しかできない</li>\n<li>ストレージを圧迫する</li>\n<li>操作が軽い</li>\n</ul>\n<h2>google-drive-ocamlfuse</h2>\n<h3>公式</h3>\n<p><a href=\"https://github.com/astrada/google-drive-ocamlfuse/wiki/Installation\">Installation | google-drive-ocamlfuse</a></p>\n<h3>インストール</h3>\n<div class=\"gatsby-code-title\">bash</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> add-apt-repository ppa:alessandro-strada/ppa\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> google-drive-ocamlfuse</code></pre></div>\n<p>でも ppa の参照先増やしたくないねって人は</p>\n<div class=\"gatsby-code-title\">bash</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> upgrade\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> opam mccs\nopam init --solver<span class=\"token operator\">=</span>mccs\nopam update\nopam <span class=\"token function\">install</span> depext\nopam depext google-drive-ocamlfuse\nopam <span class=\"token function\">install</span> google-drive-ocamlfuse</code></pre></div>\n<p>ってやれば<code class=\"language-text\">opam</code>経由でインストールできる。</p>\n<p>参考：<a href=\"https://qiita.com/teamhimeH/items/9910d648da0a9ff09946\">SSH 接続の Raspberry Pi に Google Drive をマウントする | Qiita</a></p>\n<h3>認証</h3>\n<div class=\"gatsby-code-title\">bash</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">google-drive-ocamlfuse</code></pre></div>\n<p>って出たらブラウザが立ち上がって認証トークンがでてできる。</p>\n<p>SSH 接続でやりたい人は上の参考記事を参照するとできる。<br>\n偽のブラウザ作ってブラウザの表示をターミナルに出すっていう発想がすごいよね。</p>\n<h3>マウントする</h3>\n<div class=\"gatsby-code-title\">title</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">google-drive-ocamlfuse <span class=\"token punctuation\">[</span>マウントしたいフォルダ<span class=\"token punctuation\">]</span>\n~/.opam/default/bin/google-drive-ocamlfuse <span class=\"token punctuation\">[</span>マウントしたいフォルダ<span class=\"token punctuation\">]</span>     <span class=\"token comment\"># opam経由でインストールした人</span></code></pre></div>\n<p>これやったらラズパイが 52℃ くらいになってびっくりしました。</p>\n<h2>Rclone</h2>\n<h3>公式</h3>\n<p><a href=\"https://rclone.org/downloads/\">Rclone Downloads v1.54.1 | Rclone</a></p>\n<h3>インストール</h3>\n<div class=\"gatsby-code-title\">bash</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> https://rclone.org/install.sh <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">bash</span></code></pre></div>\n<h3>認証</h3>\n<p>Google Drive についての Rclone 公式の説明<br>\n<a href=\"https://rclone.org/drive/\">Google Drive | Rclone</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">rclone config</code></pre></div>\n<p>基本指示にしたがえばできる。<br>\nclient<em>id, client</em>secret, root<em>folder</em>id, service<em>account</em>file は空欄でいい。<br>\nAuto config の設定もしなくていいし、team drive の設定もしなくていい。</p>\n<p>URL にアクセスして、出てきた認証コードをターミナルに打ち込むとできる。</p>\n<h3>使い方</h3>\n<p><strong>ミスるとデータが消えるから注意が必要</strong></p>\n<h4>基本</h4>\n<div class=\"gatsby-code-title\">bash</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">rclone <span class=\"token function\">sync</span> <span class=\"token punctuation\">[</span>同期元<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>同期先<span class=\"token punctuation\">]</span> --dry-run     <span class=\"token comment\"># 同期は行わずに、実行時に起きるファイル操作を確認する</span>\nrclone <span class=\"token function\">sync</span> <span class=\"token punctuation\">[</span>同期元<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>同期先<span class=\"token punctuation\">]</span>               <span class=\"token comment\"># 同期を行う</span></code></pre></div>\n<p>もし、rclone に<code class=\"language-text\">gdrive-remote</code>と登録してて、ラズパイ上の<code class=\"language-text\">./gdrive-local</code>っていうフォルダに同期させたいなら、<code class=\"language-text\">rclone sync gdrive-remote: ./gdrive-local</code>でできる。</p>\n<h4>オプション</h4>\n<div class=\"gatsby-code-title\">bash</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">rclone <span class=\"token function\">sync</span> <span class=\"token punctuation\">[</span>同期元<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>同期先<span class=\"token punctuation\">]</span></code></pre></div>\n<h4>マウント(実験的機能)</h4>\n<div class=\"gatsby-code-title\">bash</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">rclone <span class=\"token function\">mount</span> <span class=\"token punctuation\">[</span>同期元<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>同期先<span class=\"token punctuation\">]</span>                          <span class=\"token comment\"># これでいい</span>\nrclone --vfs-cache-mode writes <span class=\"token function\">mount</span> <span class=\"token punctuation\">[</span>同期元<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>同期先<span class=\"token punctuation\">]</span>  <span class=\"token comment\"># こっちはエラーが減るらしいけど試してない</span></code></pre></div>\n<p>マウントもできた。</p>\n<h2>自動マウント設定</h2>\n<h3>結論</h3>\n<p>rc.local ではなく、systemd を使おう。</p>\n<h3>rc.local</h3>\n<p><code class=\"language-text\">~/etc/rc.local</code>というファイルにコマンドを書き込むと、起動時に実行してくれる。</p>\n<div class=\"gatsby-code-title\">/etc/rc.local</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>任意のコマンド<span class=\"token punctuation\">]</span></code></pre></div>\n<p>しかし、コマンドの実行者が管理者になってしまうところは留意しなくてはならない。</p>\n<p>rclone の場合、mount を実行した人が管理者なら、マウントしたディレクトリも全部管理者のものになってしまい、ファイルを参照できなくなってしまう。</p>\n<p>おまけに一部の OS では非推奨らしい。</p>\n<blockquote>\n<p>RedHat、CentOS 7 系より rc.local を利用しないことが推奨されている</p>\n</blockquote>\n<p>引用元：<a href=\"https://go-journey.club/archives/11506\">【Linux】【rc.local】Linux OS 起動時に自動的に実行する設定を入れる | 100%レンタルサーバーを使いこなすサイト</a></p>\n<h3>systemd</h3>\n<p>hogehoge.service というファイルを作って systemd に管理してもらう。</p>\n<h4>マウントするスクリプトを作る</h4>\n<div class=\"gatsby-code-title\">/home/[user]/shellscript/hoge.sh</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\nrclone <span class=\"token function\">mount</span> <span class=\"token punctuation\">[</span>同期元のフォルダ<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>同期先のフォルダ<span class=\"token punctuation\">]</span></code></pre></div>\n<h4>rclone のコンフィグファイルの権限を変更する</h4>\n<div class=\"gatsby-code-title\">bash</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> <span class=\"token number\">755</span> ~/.config/rclone/rclone.config</code></pre></div>\n<h4>service ファイルを作る。</h4>\n<p>ディレクトリを間違えて<code class=\"language-text\">etc/systemd/hogehoge.service</code>としないように注意。(1 敗)</p>\n<div class=\"gatsby-code-title\">/etc/systemd/system/hogehoge.service</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">Description</span><span class=\"token operator\">=</span>To <span class=\"token function\">mount</span> Google Drive\n<span class=\"token assign-left variable\">After</span><span class=\"token operator\">=</span>network.target                <span class=\"token comment\"># ネットワーク接続後に実行する</span>\n\n<span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">ExecStart</span><span class=\"token operator\">=</span>/home/<span class=\"token punctuation\">[</span>user<span class=\"token punctuation\">]</span>/shellscript/hoge.sh\n<span class=\"token assign-left variable\">Type</span><span class=\"token operator\">=</span>simple\n<span class=\"token assign-left variable\">User</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>ユーザ名<span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">WantedBy</span><span class=\"token operator\">=</span>multi-user.target</code></pre></div>\n<p>[Service]のユーザオプションのおかげでちゃんと一般ユーザ権限のディレクトリとしてマウントできる。</p>\n<h4>自動起動の設定</h4>\n<div class=\"gatsby-code-title\">bash</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl daemon-reload            <span class=\"token comment\"># serviceファイルを読み込む</span>\n<span class=\"token function\">sudo</span> systemctl status hogehoge.service  <span class=\"token comment\"># hogehoge.serviceが読み込まれたか確認する</span>\n<span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> hogehoge.service  <span class=\"token comment\"># hogehoge.serviceを起動時に実行するようにする</span>\n<span class=\"token function\">sudo</span> systemctl disable hogehoge.service <span class=\"token comment\"># 起動しないようにする(メモ)</span></code></pre></div>\n<h4>マウントしたディレクトリを確認</h4>\n<p><code class=\"language-text\">df -h</code>すればいい<br>\n参考：<a href=\"https://narazuke.github.io/linux-command-filesystem/\">Linux のファイルシステムコマンドまとめ | NARAZUKE </a></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; overflow: visible\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2fda1ae50f72b74cf586c0233db19bae/1bba8/raspberrypi-google-drive_01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 2.5316455696202533%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAT0lEQVQI1w3FQRJAIBiAUWepGc1gicFGUqI/Q/c/zMfbvEprTT+MiAhd23A/hSwXWincHrB2pTaGGCPztPCUlzMe+BDIWfDe/99ISmzO8QFIeiLTyF/qjAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"raspberrypi google drive 01\"\n        title=\"raspberrypi google drive 01\"\n        src=\"/static/2fda1ae50f72b74cf586c0233db19bae/f058b/raspberrypi-google-drive_01.png\"\n        srcset=\"/static/2fda1ae50f72b74cf586c0233db19bae/c26ae/raspberrypi-google-drive_01.png 158w,\n/static/2fda1ae50f72b74cf586c0233db19bae/6bdcf/raspberrypi-google-drive_01.png 315w,\n/static/2fda1ae50f72b74cf586c0233db19bae/f058b/raspberrypi-google-drive_01.png 630w,\n/static/2fda1ae50f72b74cf586c0233db19bae/1bba8/raspberrypi-google-drive_01.png 642w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>できました。</p>","fields":{"slug":"/raspberrypi-google-drive/"},"frontmatter":{"title":"ラズパイでGoogle Driveを使う","created":"2021-03-11T21:17","updated":"2021-03-12T18:18","description":"Rclone を systemd で自動起動してマウントするのが良い。","tag":["raspberrypi"],"author":["nozzle"],"category":"tech"}},"previous":{"fields":{"slug":"/mac-setting-memo/"},"frontmatter":{"title":"M1 Mac環境構築メモ"}},"next":{"fields":{"slug":"/mac-backslash/"},"frontmatter":{"title":"Macでバックスラッシュを入力する"}},"relatedPosts":{"totalCount":7,"edges":[{"node":{"fields":{"slug":"/trouble-shooting-moduleerror-ndef/"},"frontmatter":{"title":"nfcpyの実験中\"ModuleNotFoundError No module named 'ndef'が出た"}}},{"node":{"fields":{"slug":"/raspberrypi-setting-memo/"},"frontmatter":{"title":"ラズパイ環境設定メモ"}}},{"node":{"fields":{"slug":"/raspberrypi-static-ipaddress/"},"frontmatter":{"title":"ラズパイのIPアドレスを固定する方法"}}},{"node":{"fields":{"slug":"/wordpress-setting/"},"frontmatter":{"title":"WordPress設定備忘録"}}},{"node":{"fields":{"slug":"/raspberrypi-ssd-boot/"},"frontmatter":{"title":"SDカードなしでRaspberry Pi 4B を SSDでUSB bootする"}}},{"node":{"fields":{"slug":"/raspberrypi-google-drive/"},"frontmatter":{"title":"ラズパイでGoogle Driveを使う"}}},{"node":{"fields":{"slug":"/pyenv-venv-virtual-environment/"},"frontmatter":{"title":"pyenvとvenvで仮想環境構築 ラズパイ編"}}}]}},"pageContext":{"id":"62ba7fc9-05e7-558b-91ab-f80fd4604e68","previousPostId":"fa976916-6220-569a-a04e-d6c6f43a5110","nextPostId":"ee581e7a-c5dc-510c-a3b8-091203605747","category":"tech","tagList":["raspberrypi"]}},"staticQueryHashes":["3284037645","500847697"]}