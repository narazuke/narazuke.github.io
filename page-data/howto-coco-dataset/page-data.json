{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/howto-coco-dataset/",
    "result": {"data":{"site":{"siteMetadata":{"title":"NARAZUKE","author":[{"name":"nozzle","summary":"who lives in gummaken.","social":{"github":"nozzlex3"}},{"name":"konnyaku","summary":"who is known as Siege Sukosuko Samurai.","social":{"github":"wabetarou"}}]}},"markdownRemark":{"id":"b2e22ae7-9963-5e5d-b1f7-dc325e1655a1","excerpt":"(執筆途中) 概要 ある画像から人物を検出しその姿勢を推定することを”pose estimation”というが（そのまま）、\n世の中にはこれに関するデータセットがいろいろある。\nこのうち”COCO”というのを使ってみる。 前準備 dataset 自体は公式サイトに置いてある。 train2017 val201…","html":"<p>(執筆途中)</p>\n<h2>概要</h2>\n<p>ある画像から人物を検出しその姿勢を推定することを”pose estimation”というが（そのまま）、\n世の中にはこれに関するデータセットがいろいろある。\nこのうち”COCO”というのを使ってみる。</p>\n<h2>前準備</h2>\n<p>dataset 自体は公式サイトに置いてある。</p>\n<ul>\n<li>train2017</li>\n<li>val2017</li>\n<li>annotations2017</li>\n</ul>\n<p>ここでは以上の三つを使うのでダウンロードする。以下のような階層構造にしておく</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">dataset_coco\n   |---annotations\n         |---person_keypoints_train2017.json\n         |---person_keypoints_val2017.json\n   |---train2017\n         |---*.jpg\n   |---val2017\n         |---*.jpg</code></pre></div>\n<p>この dataset を使いやすいデータにしてくれる COCOAPI なるものが github に存在する。\n<a href=\"https://github.com/cocodataset/cocoapi\">https://github.com/cocodataset/cocoapi</a></p>\n<p>これを gitclone して使う。</p>\n<h2>構造の説明</h2>\n<h3>ロード</h3>\n<p>アノテーションのデータをロード</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> pycocotools<span class=\"token punctuation\">.</span>coco <span class=\"token keyword\">import</span> COCO\n\ntrain_annot_path <span class=\"token operator\">=</span> <span class=\"token string\">'../dataset_coco/annotations/person_keypoints_train2017.json'</span>\nval_annot_path <span class=\"token operator\">=</span> <span class=\"token string\">'../dataset_coco/annotations/person_keypoints_val2017.json'</span>\ntrain_coco <span class=\"token operator\">=</span> COCO<span class=\"token punctuation\">(</span>train_annot_path<span class=\"token punctuation\">)</span> <span class=\"token comment\"># load annotations for training set</span>\nval_coco <span class=\"token operator\">=</span> COCO<span class=\"token punctuation\">(</span>val_annot_path<span class=\"token punctuation\">)</span> <span class=\"token comment\"># load annotations for validation set</span></code></pre></div>\n<h3>get_meta</h3>\n<p>coco からメタデータを取得する。\nyield は全てのデータを確保せず一回ずつ返す。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">get_meta</span><span class=\"token punctuation\">(</span>coco<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    ids <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>coco<span class=\"token punctuation\">.</span>imgs<span class=\"token punctuation\">.</span>keys<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> img_id <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        img_meta <span class=\"token operator\">=</span> coco<span class=\"token punctuation\">.</span>imgs<span class=\"token punctuation\">[</span>img_id<span class=\"token punctuation\">]</span>\n        ann_ids <span class=\"token operator\">=</span> coco<span class=\"token punctuation\">.</span>getAnnIds<span class=\"token punctuation\">(</span>imgIds<span class=\"token operator\">=</span>img_id<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># basic parameters of an image</span>\n        img_file_name <span class=\"token operator\">=</span> img_meta<span class=\"token punctuation\">[</span><span class=\"token string\">'file_name'</span><span class=\"token punctuation\">]</span>\n        w <span class=\"token operator\">=</span> img_meta<span class=\"token punctuation\">[</span><span class=\"token string\">'width'</span><span class=\"token punctuation\">]</span>\n        h <span class=\"token operator\">=</span> img_meta<span class=\"token punctuation\">[</span><span class=\"token string\">'height'</span><span class=\"token punctuation\">]</span>\n        <span class=\"token comment\"># retrieve metadata for all persons in the current image</span>\n        anns <span class=\"token operator\">=</span> coco<span class=\"token punctuation\">.</span>loadAnns<span class=\"token punctuation\">(</span>ann_ids<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">yield</span> <span class=\"token punctuation\">[</span>img_id<span class=\"token punctuation\">,</span> img_file_name<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">,</span> anns<span class=\"token punctuation\">]</span></code></pre></div>","fields":{"slug":"/howto-coco-dataset/"},"frontmatter":{"title":"COCO datasetの使い方","created":"2021-09-17T18:14","updated":"2021-11-08T14:53","description":"姿勢推定のやつ","tag":["dataset","pose-estimation","cv"],"author":["konnyaku"],"category":"tech"}},"previous":{"fields":{"slug":"/no-module-error/"},"frontmatter":{"title":"No module named ~~~ のerror"}},"next":{"fields":{"slug":"/gmail-with-thunderbird/"},"frontmatter":{"title":"ThunderbirdでGmailを自動分類する"}},"relatedPosts":{"totalCount":1,"edges":[{"node":{"fields":{"slug":"/howto-coco-dataset/"},"frontmatter":{"title":"COCO datasetの使い方"}}}]}},"pageContext":{"id":"b2e22ae7-9963-5e5d-b1f7-dc325e1655a1","previousPostId":"d5138e8f-e26b-569e-9220-642a1b6564a9","nextPostId":"36ee45b9-37fb-5395-99ad-5dc7a37f7a30","category":"tech","tagList":["dataset","pose-estimation","cv"]}},
    "staticQueryHashes": ["3284037645","500847697"]}