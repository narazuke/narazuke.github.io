{"componentChunkName":"component---src-templates-blog-post-js","path":"/cmake/","result":{"data":{"site":{"siteMetadata":{"title":"NARAZUKE","author":[{"name":"nozzle","summary":"who lives in gummaken.","social":{"github":"nozzlex3"}},{"name":"konnyaku","summary":"who is known as Siege Sukosuko Samurai.","social":{"github":"wabetarou"}}]}},"markdownRemark":{"id":"1a29bad0-67b8-5798-b0a9-00c189dd35cb","excerpt":"きっかけ アークナイツ自動周回の記事でc++を使ったが、\nコンパイル時にフレームワークやらpkg-configやらを入力していたので、大変。 コンパイルしたい時にいちいちメモを開かないといけない。 cmakeを使えばそんなことをしなくていい気がするので使ってみる。 まずは基本をやってみる main.cpp…","html":"<h3>きっかけ</h3>\n<p><a href=\"https://narazuke.github.com/arknights-auto\">アークナイツ自動周回</a>の記事でc++を使ったが、\nコンパイル時にフレームワークやらpkg-configやらを入力していたので、大変。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">g++ -std<span class=\"token operator\">=</span>c++11 -framework CoreGraphics -framework CoreFoundation main.cpp <span class=\"token variable\"><span class=\"token variable\">`</span>pkg-config --cflags opencv4<span class=\"token variable\">`</span></span> <span class=\"token variable\"><span class=\"token variable\">`</span>pkg-config --libs opencv4<span class=\"token variable\">`</span></span></code></pre></div>\n<p>コンパイルしたい時にいちいちメモを開かないといけない。</p>\n<p>cmakeを使えばそんなことをしなくていい気がするので使ってみる。</p>\n<h3>まずは基本をやってみる</h3>\n<ol>\n<li>\n<p>main.cppとCMakeLists.txtを書く</p>\n<div class=\"gatsby-code-title\">main.cpp</div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\nstd<span class=\"token operator\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"Hello, world!\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token operator\">::</span>endl<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">CMakeLists.txt</div>\n<div class=\"gatsby-highlight\" data-language=\"t\"><pre class=\"language-t\"><code class=\"language-t\">cmake_minimum_required(VERSION 3.1)\nproject(hello_world CXX)\nadd_executable(main_app main.cpp)</code></pre></div>\n</li>\n<li>\n<p>buildフォルダを作る(ごちゃごちゃするから)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;プロジェクトディレクトリ&gt;\n|-main.cpp\n|-CMakeLists.txt\n|-build/</code></pre></div>\n</li>\n<li>\n<p>buildフォルダ内でConfigureとGenerateを実行する</p>\n<div class=\"gatsby-code-title\">shell</div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmake <span class=\"token punctuation\">..</span></code></pre></div>\n<p><code class=\"language-text\">..</code>はCmakeList.txtの場所を示す\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; overflow: visible\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/06e9fee6dcf519fe650cadd427f28d55/5d72a/configure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.139240506329116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLklEQVQoz3VS2W7CMBDMP7TckDtx7IRASGg5UmirtlL//4OmnkVGINSH0ezK6/Hsrj1jasSpxtzPkWQ1wrhElFQIIiNxnC4xW+R4HgYYjMIrhuPoLnbwCl2hMCssAiWXKUQO44sgH1kEhRSPJjHG00RwK3InWC+36E8/2LQ92u0JjeULjlBFA112yC27xxin+erBsYNnli84HL+wfX0X4fPHr+SH/tuKtajXe3FJEXKm1teccZrb2ObuzFN6g93+E5vuzYqeRYAuSvsQHfmh/tfNLTgOwstUI+4oSDEKcAnEdJ7J/DjLW7iFsdblbkleWa2gdG03W4JuCWPnRmYLpuqkPQpTgDz31QNfl9I0O9teJ1+FB9xgYVoBiyezVAqDSEsNY47gaeBLF/c/o8QfAs3k4gk/vMIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"configure\"\n        title=\"configure\"\n        src=\"/static/06e9fee6dcf519fe650cadd427f28d55/f058b/configure.png\"\n        srcset=\"/static/06e9fee6dcf519fe650cadd427f28d55/c26ae/configure.png 158w,\n/static/06e9fee6dcf519fe650cadd427f28d55/6bdcf/configure.png 315w,\n/static/06e9fee6dcf519fe650cadd427f28d55/f058b/configure.png 630w,\n/static/06e9fee6dcf519fe650cadd427f28d55/5d72a/configure.png 834w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>ビルドする</p>\n<div class=\"gatsby-code-title\">shell</div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmake --build <span class=\"token builtin class-name\">.</span> </code></pre></div>\n<p><code class=\"language-text\">.</code>はbuildフォルダを示す</p>\n</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 563px; overflow: visible\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/487254b3466679961b1ad1a7fccf7394/7cb89/build.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.088607594936708%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtUlEQVQI12WM2VLCMBiF+xAi24zSAqaUULSSdElCusCNXvj+T/P5y60X35xl5pzEvEdqe8eYiQ/xrvvCXCby3JJmZ9Ga8uRRyggWrTuW6y3Pi5TFKnswX/6RPrrE1APT7YfqYhnvPaEPdMHRekcYPE78cBuk98Qx0jrHThUcy5J9fkQVmjfRgz6xyRSJbXr68ZtzVdN0nk/TyGGkMq3kgLtGGWi2+1wOCtYvO55mr8zmqbD5xy9J3lxhZ/eLugAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"build\"\n        title=\"build\"\n        src=\"/static/487254b3466679961b1ad1a7fccf7394/7cb89/build.png\"\n        srcset=\"/static/487254b3466679961b1ad1a7fccf7394/c26ae/build.png 158w,\n/static/487254b3466679961b1ad1a7fccf7394/6bdcf/build.png 315w,\n/static/487254b3466679961b1ad1a7fccf7394/7cb89/build.png 563w\"\n        sizes=\"(max-width: 563px) 100vw, 563px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol start=\"5\">\n<li>結果</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 133px; overflow: visible\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3e3ae1097fad23818cd2590d27ee3fa5/8ddb9/result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.31578947368421%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQklEQVQY0zWQ6U4CQRCE9wUMguJFEERFYMU9OJcFFbnkEAmiyCGEoNF4m6gxvvzn7CT+qFTPdHd1dSspPU/dyFDRM9RNi5xq4l4JsLoeIrQTp3sxZji+pdW+ot0ZcHzSpNMdyvzuns5wdMvZ+TW9qwmWXUbR1DR2VMOKGYINDrZVFtw+omoSI2GTP6zSaPY4F2J1wUfFOoXDGrppk82VGI3vGIzmzObP2IUqis8fxheMSldB4SgU1ghHdLyrQQmXx4fLvSGxKOL//3S2SGArhj8QYVP0L3k38Sz7USy7xPvHL49Pn1z2p5SrbRqtHpPpA4WjU9nsrPf8+s3Tyxc3k3v6gxmVWodub8zL2w/FUlPWrKxtoThT1HharhDXshwIaIYlkJMunDs5zoxEnlTmGFNwVE0Q209hJgvyHRQajpgz/A8sJqTBEWMXUgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"result\"\n        title=\"result\"\n        src=\"/static/3e3ae1097fad23818cd2590d27ee3fa5/8ddb9/result.png\"\n        srcset=\"/static/3e3ae1097fad23818cd2590d27ee3fa5/8ddb9/result.png 133w\"\n        sizes=\"(max-width: 133px) 100vw, 133px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>実際にcmakeを適用してみる</h3>\n<h4>外部ライブラリの導入</h4>\n<p>とりあえず上記のCMakeLists.txtのままやってみたら外部ライブラリのincludeでエラーを出したのでやってみる。</p>\n<p><code class=\"language-text\">find_package()</code>で外部ライブラリを探せる。\nCMakeLists.txtに<code class=\"language-text\">find_package(OpenCV 4.5.1)</code>という一文を追加したらちゃんと探せた。</p>\n<div class=\"gatsby-code-title\">shell</div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">-- Found OpenCV: /usr/local/Cellar/opencv/4.5.1_2 <span class=\"token punctuation\">(</span>found suitable version <span class=\"token string\">\"4.5.1\"</span>, minimum required is <span class=\"token string\">\"4.5.1\"</span><span class=\"token punctuation\">)</span> </code></pre></div>\n<p>最終的に<a href=\"https://cha-shu00.hatenablog.com/entry/2018/09/02/143853\">【C++】OpenCV3をOSXにインストールしてcmakeで優勝💪💪【完全に理解した】</a>\nをコピペした</p>\n<div class=\"gatsby-code-title\">CMakeLists.txt</div>\n<div class=\"gatsby-highlight\" data-language=\"t\"><pre class=\"language-t\"><code class=\"language-t\">cmake_minimum_required(VERSION 3.1)\nproject(arknights_auto CXX)\nset(CMAKE_CXX_STANDARD 11)\nset(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -Wall&quot;)\nfind_package(OpenCV 4.5.1 REQUIRED)\ninclude_directories( ${OpenCV_INCLUDE_DIRS} )\nadd_executable(main_app main.cpp)\ntarget_link_libraries(main_app ${OpenCV_LIBS})</code></pre></div>\n<p><code class=\"language-text\">CMAKE_CXX_STANDARD</code>にはバージョン、\n<code class=\"language-text\">CMAKE_CXX_FLAGS</code>にoptionをセットできる。\nここでは直接入力値を代入できるが、<code class=\"language-text\">add_definitions</code>でも設定できる。\n<code class=\"language-text\">include_directories</code>でincludeして、\n<code class=\"language-text\">target_link_libraries</code>でopencvのライブラリとリンクしている。\nフレームワークもこれで指定できる。\nでも<code class=\"language-text\">target_link_libraries</code>は使わないライブラリもリンクするからよくないらしい。\nCoreGraphicsのフレームワークもこれで入れる。\n最終的には次のようにしてコンパイルできるようになった。</p>\n<div class=\"gatsby-code-title\">CMakeLists.txt</div>\n<div class=\"gatsby-highlight\" data-language=\"t\"><pre class=\"language-t\"><code class=\"language-t\">cmake_minimum_required(VERSION 3.1)\nproject(arknights_auto CXX)\nset(CMAKE_CXX_STANDARD 11)\nadd_definitions(-std=c++11 -Wall)\nfind_package(OpenCV 4.5.1 REQUIRED)\ninclude_directories( ${OpenCV_INCLUDE_DIRS} )\nadd_executable(main_app main.cpp)\ntarget_link_libraries(main_app ${OpenCV_LIBS})\ntarget_link_libraries(main_app &quot;-framework CoreGraphics&quot;)\ntarget_link_libraries(main_app &quot;-framework CoreFoundation&quot;)</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 457px; overflow: visible\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/17a6dc356fdd762552c9b48064c4bd2a/34f1d/final.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.78481012658227%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACgklEQVQ4y41U13LbQAzkJyRytwqrTEkUe68iJcUlxRn//8dsANDS2DPJTB527gjijsDugkqaJ0jLDI7nY+sFMJce0ryHH1aI4gaun8s+Tjsk2Y5yckEY1wgiRoWFtsbltYrrWx2KY3uou28oqgHG0sVsbkuCqm9wP1vibmrhnkH7E6bzhzH+/nxzZ8hlcuFmm6LpnlBWB3T9C7KiR1kfkJcDvl7MBJPL+af9CV8m03P8BMUPShwff4PXqjlSpQe6dJAW7XUEj+JLO5B17SQSM6ytUMMtc2xsvZYcZaba0Iw1lW5hrq4E3BK3rRsOdHMr7RuWS3kOVG2D2cKWdYxtxjjlqHRGCeMAMQmz9QOsty4eVoG07AUFkZ9RRSGYFt57YSnPq00Ex00lzqJxAUwBC6METo5+eEWWH+H7DXH5hN3uF+1baDpVoHuy2quMKvZhmOQEK5R1oTq4uFLPkAuH/Rva9ieStEXdPKIhlOUBFVUZJx1xSTxtYhyPr2haild7yt2hJwHLeoBqLLFyXOKZKVhBef7+JsrmdYqnHz12h0pQNBmqLsfxuUO3r9D0ObIqRX+sUbY5mqHATLWg0yWWzTzaAqXbvZDClRg1ThtSLaQv7xElNfGTSYyrDOOKfKZhurBIFIt4s8gmc8HkciHtSsuauSKFHijBpOQlHTKodO9duVE9zdie1Z6S8RlzdS05uumIQ65utNHYQeBTu9Ri3dLIjSPG4PFy/YIUjUVR9hiPGfvOcTO49J5XVpptdB493yvIKpFUxWDjXlwtPuFfk3LC6TKuUuEfAQ89mzQmpaOklarYizyK/HVO/Divf8O5ZT5we2+ewXzwYd7zD+Bj8v/gD8QXuxR6gQwOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"final\"\n        title=\"final\"\n        src=\"/static/17a6dc356fdd762552c9b48064c4bd2a/34f1d/final.png\"\n        srcset=\"/static/17a6dc356fdd762552c9b48064c4bd2a/c26ae/final.png 158w,\n/static/17a6dc356fdd762552c9b48064c4bd2a/6bdcf/final.png 315w,\n/static/17a6dc356fdd762552c9b48064c4bd2a/34f1d/final.png 457w\"\n        sizes=\"(max-width: 457px) 100vw, 457px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>参考</h3>\n<p><a href=\"https://kamino.hatenablog.com/entry/cmake_tutorial1\">勝手に作るCMake入門 その1 基本的な使い方</a></p>\n<p><a href=\"https://qiita.com/sanishi_pompom/items/02b158dfad3a5dafd0a1\">OpenCV4.1.0をCMakeを使って導入する方法(Visual Studio 2019)</a></p>\n<p><a href=\"https://cha-shu00.hatenablog.com/entry/2018/09/02/143853\">【C++】OpenCV3をOSXにインストールしてcmakeで優勝💪💪【完全に理解した】</a></p>\n<p><a href=\"https://qiita.com/progrhyme/items/c0f21e2a71cfe6fdb7a8\">CMake覚え書き</a></p>\n<p>最後のリンクは項目化してあってわかりやすい</p>","fields":{"slug":"/cmake/"},"frontmatter":{"title":"cmakeをつかう","created":"2021-02-20T10:23","updated":"2021-02-22T13:18","description":"コンパイルを楽にしたいのでcmakeつかいます","tag":["cmake","cpp"],"author":["konnyaku"],"category":"tech"}},"previous":{"fields":{"slug":"/kon20210219/"},"frontmatter":{"title":"日記"}},"next":{"fields":{"slug":"/kon20210220/"},"frontmatter":{"title":"日記"}},"relatedPosts":{"totalCount":2,"edges":[{"node":{"fields":{"slug":"/cpp-memo/"},"frontmatter":{"title":"c++のoptionについて"}}},{"node":{"fields":{"slug":"/cmake/"},"frontmatter":{"title":"cmakeをつかう"}}}]}},"pageContext":{"id":"1a29bad0-67b8-5798-b0a9-00c189dd35cb","previousPostId":"eb1ee6b8-c248-598d-836b-4b5c28ec2e8e","nextPostId":"f0964e48-14d2-5049-902a-c056b285d24f","category":"tech","tagList":["cmake","cpp"]}},"staticQueryHashes":["3284037645","500847697"]}