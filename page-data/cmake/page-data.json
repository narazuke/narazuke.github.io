{"componentChunkName":"component---src-templates-blog-post-js","path":"/cmake/","result":{"data":{"site":{"siteMetadata":{"title":"NARAZUKE","author":[{"name":"nozzle","summary":"who lives in gummaken.","social":{"github":"nozzlex3"}},{"name":"konnyaku","summary":"who is known as Siege Sukosuko Samurai.","social":{"github":"wabetarou"}}]}},"markdownRemark":{"id":"5d2b7d41-cc20-522a-b94f-a8f90ac5b896","excerpt":"きっかけ アークナイツ自動周回の記事でc++を使ったが、\nコンパイル時にフレームワークやらpkg-configやらを入力していたので、大変。 コンパイルしたい時にいちいちメモを開かないといけない。 cmakeを使えばそんなことをしなくていい気がするので使ってみる。 まずは基本をやってみる main.cpp…","html":"<h3>きっかけ</h3>\n<p><a href=\"https://narazuke.github.com/arknights-auto\">アークナイツ自動周回</a>の記事でc++を使ったが、\nコンパイル時にフレームワークやらpkg-configやらを入力していたので、大変。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">g++ -std<span class=\"token operator\">=</span>c++11 -framework CoreGraphics -framework CoreFoundation main.cpp <span class=\"token variable\"><span class=\"token variable\">`</span>pkg-config --cflags opencv4<span class=\"token variable\">`</span></span> <span class=\"token variable\"><span class=\"token variable\">`</span>pkg-config --libs opencv4<span class=\"token variable\">`</span></span></code></pre></div>\n<p>コンパイルしたい時にいちいちメモを開かないといけない。</p>\n<p>cmakeを使えばそんなことをしなくていい気がするので使ってみる。</p>\n<h3>まずは基本をやってみる</h3>\n<ol>\n<li>main.cppとCMakeLists.txtを書く</li>\n</ol>\n<div class=\"gatsby-code-title\">main.cpp</div>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"Hello, world!\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">CMakeLists.txt</div>\n<div class=\"gatsby-highlight\" data-language=\"t\"><pre class=\"language-t\"><code class=\"language-t\">cmake_minimum_required(VERSION 3.1)\nproject(hello_world CXX)\nadd_executable(main_app main.cpp)</code></pre></div>\n<ol start=\"2\">\n<li>buildフォルダを作る(ごちゃごちゃするから)</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;プロジェクトディレクトリ>\n|-main.cpp\n|-CMakeLists.txt\n|-build/</code></pre></div>\n<ol start=\"3\">\n<li>buildフォルダ内でConfigureとGenerateを実行する</li>\n</ol>\n<div class=\"gatsby-code-title\">shell</div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmake <span class=\"token punctuation\">..</span></code></pre></div>\n<p><code class=\"language-text\">..</code>はCmakeList.txtの場所を示す\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; overflow: visible\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/06e9fee6dcf519fe650cadd427f28d55/5d72a/configure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.139240506329116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLklEQVQoz3WS6U7DMBCE8w7Qu8192U7cpkl6hhYQIPH+DzRoFhK1qvgx2rW8/jzetaO1RRgrLN0UUWLhhwZBVMALtORhXGKxSvE89jCa+IPG0+Au7+XkqkCu11h5mRwmiNEPf4G8ZOXlUjyZhZjOI9Et5A5oyxbd5QvbukPdXlDV3Z/OyPIKyjRI82q4jHmcrh8c93J0ucPp/IF2/yrg69u3rE/dJ5SpYTdHcUkIY5JthjXzOLWIEzvsOZna4nB8x7Z5Qbu/CoAuTLkTR66v/nVzK7aDcpKsEncEEkYAh0DNl4n0j728VT8w1vbrfkiOKdbIlEUQGdAtpU0jkU/QRSPPI5gAxqWbPcRhKFV1gCkb+Src4ARzXYtYPFvEUugFSmqYswVPI1decf8zDH4AAs3k4umujUAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"configure\"\n        title=\"configure\"\n        src=\"/static/06e9fee6dcf519fe650cadd427f28d55/f058b/configure.png\"\n        srcset=\"/static/06e9fee6dcf519fe650cadd427f28d55/c26ae/configure.png 158w,\n/static/06e9fee6dcf519fe650cadd427f28d55/6bdcf/configure.png 315w,\n/static/06e9fee6dcf519fe650cadd427f28d55/f058b/configure.png 630w,\n/static/06e9fee6dcf519fe650cadd427f28d55/5d72a/configure.png 834w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol start=\"4\">\n<li>ビルドする</li>\n</ol>\n<div class=\"gatsby-code-title\">shell</div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">cmake --build <span class=\"token builtin class-name\">.</span> </code></pre></div>\n<p><code class=\"language-text\">.</code>はbuildフォルダを示す</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 563px; overflow: visible\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/487254b3466679961b1ad1a7fccf7394/7cb89/build.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.088607594936708%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtklEQVQI12XIyVaDMABAUT5CpMM5WmhpIqS0YhMgg2FoN7rw/7/meezWxd3cRF8inbmj9cL7JeLsF/q6IKUhL85I2dGcPEJohDAoZVlv9zyvclab4iFb/8kfl+huYrn90F4N830kjAEbHIN3hMnjgmO6TYTRE+fI4BwHUVE3DaWsEZXiKGve1IldIUhMPzLO35zbjt56PnSPDZFWD/Q24D4jR6nYl5JSVmxfDjylr6RZTprt/vkFSd5cYZCBmBAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"build\"\n        title=\"build\"\n        src=\"/static/487254b3466679961b1ad1a7fccf7394/7cb89/build.png\"\n        srcset=\"/static/487254b3466679961b1ad1a7fccf7394/c26ae/build.png 158w,\n/static/487254b3466679961b1ad1a7fccf7394/6bdcf/build.png 315w,\n/static/487254b3466679961b1ad1a7fccf7394/7cb89/build.png 563w\"\n        sizes=\"(max-width: 563px) 100vw, 563px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol start=\"5\">\n<li>結果</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 133px; overflow: visible\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3e3ae1097fad23818cd2590d27ee3fa5/8ddb9/result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.31578947368421%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRklEQVQY0z2QWU/CcBDE+wWMggpqgxREtFTogRylgCKKIgoN1oNDjBGjEfBI1Bi//M/0/+DDPOzO7s7MSjmjTNMscGQUaFo2Jc0iEIoSXo0TT6TpXgzpD8ecta9ouz32D1q43b7gN7cM+oMx550bvKsRtnOIpGt5HFXHTpk4qklmQ2MuIKNqu5hZh3K1wWnLo+P2aLY89mpNKtVjDMuhWKozGD7SGzxw/zDFqTSQ5EgSWVGFKyWRJp7USW4bLIcVgfmgzHxgTWAhKP/388Ua0ViKSHSbdUVlcXmd4FIEyXbqvH/88jL55PL6jsNGm9Mzj9HdM5W9E7Hsx5u+fjOZfXE7euK6d8/RsUvXGzJ7+6FWb4mZ0EoMyVfR0nkRIa0XyehFdNNGN0vChf8n35mZLZMr7GNly6haltRODmu3ImollhLHfPE/LCakwRw0HDAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"result\"\n        title=\"result\"\n        src=\"/static/3e3ae1097fad23818cd2590d27ee3fa5/8ddb9/result.png\"\n        srcset=\"/static/3e3ae1097fad23818cd2590d27ee3fa5/8ddb9/result.png 133w\"\n        sizes=\"(max-width: 133px) 100vw, 133px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>実際にcmakeを適用してみる</h3>\n<h4>外部ライブラリの導入</h4>\n<p>とりあえず上記のCMakeLists.txtのままやってみたら外部ライブラリのincludeでエラーを出したのでやってみる。</p>\n<p><code class=\"language-text\">find_package()</code>で外部ライブラリを探せる。\nCMakeLists.txtに<code class=\"language-text\">find_package(OpenCV 4.5.1)</code>という一文を追加したらちゃんと探せた。</p>\n<div class=\"gatsby-code-title\">shell</div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">-- Found OpenCV: /usr/local/Cellar/opencv/4.5.1_2 <span class=\"token punctuation\">(</span>found suitable version <span class=\"token string\">\"4.5.1\"</span>, minimum required is <span class=\"token string\">\"4.5.1\"</span><span class=\"token punctuation\">)</span> </code></pre></div>\n<p>最終的に<a href=\"https://cha-shu00.hatenablog.com/entry/2018/09/02/143853\">【C++】OpenCV3をOSXにインストールしてcmakeで優勝💪💪【完全に理解した】</a>\nをコピペした</p>\n<div class=\"gatsby-code-title\">CMakeLists.txt</div>\n<div class=\"gatsby-highlight\" data-language=\"t\"><pre class=\"language-t\"><code class=\"language-t\">cmake_minimum_required(VERSION 3.1)\nproject(arknights_auto CXX)\nset(CMAKE_CXX_STANDARD 11)\nset(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -Wall&quot;)\nfind_package(OpenCV 4.5.1 REQUIRED)\ninclude_directories( ${OpenCV_INCLUDE_DIRS} )\nadd_executable(main_app main.cpp)\ntarget_link_libraries(main_app ${OpenCV_LIBS})</code></pre></div>\n<p><code class=\"language-text\">CMAKE_CXX_STANDARD</code>にはバージョン、\n<code class=\"language-text\">CMAKE_CXX_FLAGS</code>にoptionをセットできる。\nここでは直接入力値を代入できるが、<code class=\"language-text\">add_definitions</code>でも設定できる。\n<code class=\"language-text\">include_directories</code>でincludeして、\n<code class=\"language-text\">target_link_libraries</code>でopencvのライブラリとリンクしている。\nフレームワークもこれで指定できる。\nでも<code class=\"language-text\">target_link_libraries</code>は使わないライブラリもリンクするからよくないらしい。\nCoreGraphicsのフレームワークもこれで入れる。\n最終的には次のようにしてコンパイルできるようになった。</p>\n<div class=\"gatsby-code-title\">CMakeLists.txt</div>\n<div class=\"gatsby-highlight\" data-language=\"t\"><pre class=\"language-t\"><code class=\"language-t\">cmake_minimum_required(VERSION 3.1)\nproject(arknights_auto CXX)\nset(CMAKE_CXX_STANDARD 11)\nadd_definitions(-std=c++11 -Wall)\nfind_package(OpenCV 4.5.1 REQUIRED)\ninclude_directories( ${OpenCV_INCLUDE_DIRS} )\nadd_executable(main_app main.cpp)\ntarget_link_libraries(main_app ${OpenCV_LIBS})\ntarget_link_libraries(main_app &quot;-framework CoreGraphics&quot;)\ntarget_link_libraries(main_app &quot;-framework CoreFoundation&quot;)</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 457px; overflow: visible\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/17a6dc356fdd762552c9b48064c4bd2a/34f1d/final.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.78481012658227%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACh0lEQVQ4y42U527bUAyF9QhtnDiOtWXJ2sPWvhqWRzM6UuT9H+YUpGMjAVqgPz7wiqCueDgklXWBsq0QJimiJMPKSVDWE9KNwDbvEac1n/NyRFHtECU1s8k7ZFtCQDN83M51zBcmpNBN0I3f0Ig9LCeGorocoJsBloqDB9nGklCcK7K6Pvvfn+8fLL6MLwyiEv34hFYcMU4vqJoJbXdE3e7xdaYwN7fqp/OFLzfy1X9BSrMWp8ffICv6ExpxRNXsWaLrb5FkLRw3Y+uHBfssO+LSkGTynaV3HCMpugvD8rFUbKi6x5Akkm1aIcxVxPItO4ZhhdCNAIrmsj37grPfDKAbPqRNniGvC0RpBj+KsfYylpxkDaKkgutvQGWhc7Jp+dkLtgjjkv3UNEqASkCNkbKwxrR/RVWfkKY9WvGE3e4X0nSAYcYwzISt61UwrRTWKsPK3rDV9BCzO/0KX7g/vGEYfqIoB3T9I/r+EW17hOiOyIsRednBD3KcTq/ohyOEOKAod5imF7TdHrrlwAtjOC6VwIP0/P2NO1t3JZ5+TNgdBdP0FcRY4/Q8YjwI9FONSpSYTh3aoUa/b6DoNkzbg+1SHV1GGncvSDPBg5qXPfxwg7Y7YFt0iNOKfZTlJheYLwzImg1FsyGrNr7OVObmVmO5LNlYedDNNWR1BVlzMF9YsOzkvXPn7hlWdO22rLqMqvscY65CnpC7e+M82FmWou4Emm5AWZ9XjKD1itMGXpBzR2nGaM1o7sK4QpzUbKnTNEbX1UuTBmtvy1kRNLizO+0T/9qUC5fLKEuJfgS09DSkeTlgWwycFc0irSJ9nQI/7uvfuEqmFxbL1RWqB71MZ/oBfAz+H/4AxBe7FGSA2E4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"final\"\n        title=\"final\"\n        src=\"/static/17a6dc356fdd762552c9b48064c4bd2a/34f1d/final.png\"\n        srcset=\"/static/17a6dc356fdd762552c9b48064c4bd2a/c26ae/final.png 158w,\n/static/17a6dc356fdd762552c9b48064c4bd2a/6bdcf/final.png 315w,\n/static/17a6dc356fdd762552c9b48064c4bd2a/34f1d/final.png 457w\"\n        sizes=\"(max-width: 457px) 100vw, 457px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>参考</h3>\n<p><a href=\"https://kamino.hatenablog.com/entry/cmake_tutorial1\">勝手に作るCMake入門 その1 基本的な使い方</a></p>\n<p><a href=\"https://qiita.com/sanishi_pompom/items/02b158dfad3a5dafd0a1\">OpenCV4.1.0をCMakeを使って導入する方法(Visual Studio 2019)</a></p>\n<p><a href=\"https://cha-shu00.hatenablog.com/entry/2018/09/02/143853\">【C++】OpenCV3をOSXにインストールしてcmakeで優勝💪💪【完全に理解した】</a></p>\n<p><a href=\"https://qiita.com/progrhyme/items/c0f21e2a71cfe6fdb7a8\">CMake覚え書き</a></p>\n<p>最後のリンクは項目化してあってわかりやすい</p>","fields":{"slug":"/cmake/"},"frontmatter":{"title":"cmakeをつかう","created":"2021-02-20T10:23","updated":"2021-02-22T13:18","description":"コンパイルを楽にしたいのでcmakeつかいます","tag":["cmake","cpp"],"author":["konnyaku"],"category":"tech"}},"previous":{"fields":{"slug":"/kon20210219/"},"frontmatter":{"title":"日記"}},"next":{"fields":{"slug":"/kon20210220/"},"frontmatter":{"title":"日記"}},"relatedPosts":{"totalCount":5,"edges":[{"node":{"fields":{"slug":"/make-cmake-difference/"},"frontmatter":{"title":"CMakeとMakefileの違い"}}},{"node":{"fields":{"slug":"/optitrack/"},"frontmatter":{"title":"optitrack"}}},{"node":{"fields":{"slug":"/cpp-option/"},"frontmatter":{"title":"c++のoptionについて"}}},{"node":{"fields":{"slug":"/cpp-memo/"},"frontmatter":{"title":"c++のoptionについて"}}},{"node":{"fields":{"slug":"/cmake/"},"frontmatter":{"title":"cmakeをつかう"}}}]}},"pageContext":{"id":"5d2b7d41-cc20-522a-b94f-a8f90ac5b896","previousPostId":"e8b2179a-1c25-512f-b0c6-49514c2a70fa","nextPostId":"2482893c-88cc-5969-a499-3f73f8505b0e","category":"tech","tagList":["cmake","cpp"]}},"staticQueryHashes":["3284037645","500847697"]}